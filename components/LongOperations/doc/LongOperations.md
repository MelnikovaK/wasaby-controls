Менеджер длительных операций

Операции, требующие для своёго выполнения длительного времени должны отображаться пользователю не блокирующим способом. За ходом выполнения
длительных операций пользователь может следить в специализированных компонентах, таких как SBIS3.CONTROLS.LongOperationsPopup (информационное окно
длительных операций), SBIS3.CONTROLS.LongOperationsRegistry (реестр длительных операций) и других. Длительные операции могут иметь разную природу
и выполняться в разных программных модулях, как на стороне сервера, так и в браузере. Менеджер длительных операций
(SBIS3.CONTROLS.LongOperations.Manager) собирает эту разнородную информацию и предоставляет её визуальным компонентам в унифицированном виде.
<br/>
Менеджер генерирует события обо всех известных ему изменениях в ходе выполнения длительных операций где-либо. Подписываясь на эти события
визуальные компоненты могут отображать эти изменения пользователю.
<br/>
Для получения списка текущих длительных операций от менеджера визуальные компоненты используют вызов его метода fetch. При обработке действий
пользователя с отображаемыми длительными операциями, такими как приостановить/возобновить выполнение операции или удалить операцию, визуальные
компоненты обращаются к методу менеджера callAction. При отображении истории выполнения какой-либо длительной операции визуальные компоненты
используют методы менеджера canHasHistory и history.
<br/>
Для сбора информации о длительных операциях и выполнения действий с ними менеджер использует продюсеры длительных операций. Продюсер длительных
операций - объект, реализующий интерфейс SBIS3.CONTROLS.LongOperations.IProducer. Каждый продюсер обычно отвечает за работу с длительными операциями
в какой-либо одной узкой предметной области. Например продюсер SBIS3.Engine.LongOperations.LRSProducer предоставляет доступ к длительным
операциям, с которыми работает сервис LRS (/long-requests/service/). Продюсер SBIS3.EDO.CD.UploadLongOperationsProducer предоставляет доступ к
информации о загрузке файлов менеджером загрузок. Другие продюсеры работают с длительными операциями иного характрера.
<br/>
Исключение составляет типовой продюсер (SBIS3.CONTROLS.LongOperations.GenericProducer), предоставляющий (несколько ограниченную) функциональность
для работы с любыми длительными операциями, когда более подробная обработка не требуется.
<br/>
Для того, чтобы менеджер начал работу с каким-нибудь продюсером, этот продюсер должен быть зарегистрирован в менеджере с использованием его метода
register или registerByName. Метод register регистрирует уже созданный экземпляр продюсера. Метод registerByName сначала попытается создать
экземпляр продюсера, и если это поличилось - зарегистрирует его. До тех пор, пока зарегистрированный продюсер не будет раз-регистрирован с помощью
метода unregister, менеджер будет "видеть" его длительные операции и работать с ними. Раз-регистрация производится также либо непосредственно по
экземпляру продюсера, либо по имени.
<br/>
Менеджер взаимодействует с продюсерами согласно интерфейсу SBIS3.CONTROLS.LongOperations.IProducer. Интерфейс содержит методы подписки на события
subscribe(event, listener) и unsubscribe(event, listener) для того, чтобы менеджер мог подписаться на события этого продюсера. Продюсер должен
генерировать следующие события:
<ul>
   <li>@event onStarted Происходит при начале исполнения новой длительной операции</li>
   <li>@event onChanged Происходит при изменении свойств длительной операции в процесе исполнения</li>
   <li>@event onEnded Происходит при завершении длительной операции по любой причине. При завершении вследствие ошибки предоставляется информация
   об ошибке в свойстве data.error</li>
   <li>@event onDeleted При удалении длительной операции</li>
</ul>
При генерации событий слушатель события, подписавшийся через метод subscribe должен получить два аргумента - дескриптор события evtName, содержащий
имя события и объект data, содержаший актуальные данные события:
<pre>
   producer.subscribe('onstarted', function (evtName, data) {
         ...
      });
</pre>
Каждое событие должно содержать имя продюсера в свойстве data.producer и идентификатор длительной операции, к которой относиться данное событие, в
свойстве data.operationId (возможен список идентификаторов в свойстве data.operationIds для событий onEnded и onDeleted).
<br/>
Идентификаторы длительных операций каждый продюсер устанавливает по собственному усмотрению, но они должны быть уникальны для всех операций одного
продюсера.
<br/>
Событие onStarted должно содержать количество подзадач в свойстве data.progress.total, если оно отлично от 1.
<br/>
Событие onChanged должно содержать имя изменённого свойства в свойстве data.changed, оно может принимать значения: 'status', 'progress' или
'notification'. В соответствии с изменённым свойством указывается новое значение статуса в свойстве data.status, если изменился статус; новая
информация о прогресе выполнения в свойствах data.progress.total и data.progress.value, если изменился прогресс; сообщение о ходе выполнения в
свойстве data.notification, если получено сообщение.
<br/>
Событие onEnded при успешном завершении может содержать данные о количестве подзадач в свойствах data.progress.total и data.progress.value,
если они отличны от 1. При завершении с ошибкой событие должно содержать сообщение об ошибке в свойстве data.error
<br/>
Событие onDeleted дополнителшьных свойств не имеет
<br/>


//getName
//hasCrossTabEvents
//hasCrossTabData
//fetch: function (count) {
//callAction: function (action, operationId) {
//subscribe: function (eventType, listener) {
//unsubscribe: function (eventType, listener) {
//destroy


@demo SBIS3.CONTROLS.Demo.MyLongOperations
@demo SBIS3.CONTROLS.Demo.MyLongOperationsSvc
