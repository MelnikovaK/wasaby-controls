<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
   <meta name="ws-access" content=""/>
   <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
   <title>C:/projects/sbis3-controls/DataSetCloud/client/Тема сайта/test.xaml</title>
   <link rel="stylesheet" href="/ws/css/core.css" type="text/css"/>
   <link rel="stylesheet" href="/ws/css/themes/wi_scheme.css" type="text/css"/>

   <link rel="stylesheet" type="text/css" href="/resources/Tema_sajta/fonts/index.css">
   <link rel="stylesheet" type="text/css" href="/resources/Tema_sajta/icons/index.css">

   <script type="text/javascript">
      // new config support
      window.wsConfig = {
         wsRoot: '/ws/',
         appRoot: '/',
         resourceRoot: '/resources/',
         defaultServiceUrl: '/service/sbis-rpc-service300.dll',
         theme: 'wi_scheme',
         userConfigSupport: false,
         globalConfigSupport: true,
         saveLastState: true
      };
      window.WSRootPath = '/ws/';
      window.ResourcePath = '/resources/';
      window.ServicesPath = '/service/sbis-rpc-service300.dll';
      window.WSTheme = 'wi_scheme';
   </script>

   <script type="text/javascript" src="//cdn.sbis.ru/requirejs/2.1.6/require-min.js"></script>
   <script type="text/javascript" data-pack-name="require" src="/ws/ext/requirejs/config.js"></script>

   <script type="text/javascript" src="//cdn.sbis.ru/jquery/1.6.4/jquery-full.js"></script>
   <script type="text/javascript" src="//cdn.sbis.ru/jquery-cookie/04-04-2014/jquery-cookie-full.js"></script>

   <script type="text/javascript" src="/resources/contents.js"></script>

   <script type="text/javascript" data-pack-name="ws" src="/ws/lib/core.js"></script>

   <script type="text/javascript" id="ws-include-components"></script>


   <script type="text/javascript">
      $ws.core.ready.addCallback(function () {
         require([ 'bootup' ], function () {
            $ws.core.bootup();
         });
      });
   </script>

   <style>

      table {
         width: 100%;
      }

      table td {
         padding: 25px;
         border: 1px solid #000000;
         vertical-align: top;
         width: 50%;
      }

      .listViewItem{
         position: relative;
      }

      .controls-ListView__item {
         overflow: hidden;
         position: relative;
      }
      .controls-ListView__itemActions {
         position: absolute;
         height: 16px;
         right: 0;
         top: 50%;
         margin-top: -8px;
         z-index: 10;
         display: none;
      }
      .controls-ListView__action {
         margin-right: 16px;
      }

      .taskIcon {
         float: left;
         margin-top: 10px;
         cursor: pointer;
      }
      .taskTxt {
         height: 44px;
         line-height: 44px;
         padding-left: 35px;
         font-size: 24px;

      }
      .taskComplete {
         color: #a9a9a9;
         text-decoration: line-through;
      }

   </style>

</head>
<body>

<table>
   <tr>
      <td>
         <p>ListView DataSourceBL</p>

         <div id="ListViewDS1" class="testBlock listView"></div>

      </td>
      <td>
         <p>ListView DataSourceArray</p>

         <div id="ListViewDS2" class="testBlock listView"></div>

      </td>
   </tr>
</table>


<script type="text/javascript">
   $ws.core.withComponents('Source').addCallback(function () {
      $(document).ready(function () {
         require([
            'js!SBIS3.CONTROLS.ListViewDS',
            'js!SBIS3.CONTROLS.Record',
            'js!SBIS3.CONTROLS.DataSourceArray',
            'js!SBIS3.CONTROLS.DataSourceBL'
         ], function (ListViewDS, Record, DataSourceArray, DataSourceBL) {

            var ds1 = new DataSourceBL('Заметка');

            var itemTpl1 = '<div class="listViewItem" style="overflow: hidden; border-bottom: 1px solid">\
                     <div class="taskIcon icon-24 icon-Successful{{?it.get("Завершена")}} icon-done{{??}} icon-disabled{{?}}"></div>\
                     <div class="taskTxt{{?it.get("Завершена")}} taskComplete{{?}}">{{=it.get("Содержимое")}}</div>\
               </div>';

            new ListViewDS({
               element: "ListViewDS1",
               dataSource: ds1,
               itemTemplate: itemTpl1,
               itemsActions : [
                  {
                     icon : 'sprite:icon-16 icon-Erase icon-error',
                     handler : function(id) {
                        var self = this;
                        this._dataSource.destroy(id).addCallback(function(){
                           self._drawItems();
                        });

                     }
                  }
               ],
               elemClickHandler : function(id, data, target){
                  if ($(target).hasClass('taskIcon')) {
                     var self = this;
                     data.set('Завершена', !(data.get('Завершена')));
                     this._dataSource.update(data).addCallback(function(){
                        self._drawItems();
                     });
                  }
                  else if ($(target).hasClass('taskTxt')) {

                  }
               }

            });

            var ds2 = new DataSourceArray({
               data: [
                  {'@Заметка': 1, 'Содержимое': 'Поиграть в бильярд', 'Завершена': false},
                  {'@Заметка': 2, 'Содержимое': 'Посидеть в планшете', 'Завершена': false},
                  {'@Заметка': 3, 'Содержимое': 'Пожрать', 'Завершена': true}
               ],
               keyField: '@Заметка'
            });

            new ListViewDS({
               element: "ListViewDS2",
               dataSource: ds2,
               itemTemplate: itemTpl1,
               itemsActions : [
                  {
                     icon : 'sprite:icon-16 icon-Erase icon-error',
                     handler : function(id) {
                        var self = this;
                        this._dataSource.destroy(id).addCallback(function(){
                           self._drawItems();
                        });

                     }
                  }
               ],
               elemClickHandler : function(id, data, target) {
                  if ($(target).hasClass('taskIcon')) {
                     var self = this;
                     data.set('Завершена', !(data.get('Завершена')));
                     this._dataSource.update(data).addCallback(function(){
                        self._drawItems();
                     });
                  }
                  else if ($(target).hasClass('taskTxt')) {

                  }
               }
            });

         });
      })
   });
</script>
</body>
</html>