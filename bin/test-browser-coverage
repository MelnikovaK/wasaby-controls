#!/bin/sh
# Run unit testing via browser

node -v
npm install

node node_modules/istanbul/lib/cli instrument --complete-copy --output components-covered components
node node_modules/istanbul/lib/cli instrument --complete-copy --output Controls-covered Controls

mv components components-origin
mv components-covered components
mv Controls Controls-origin
mv Controls-covered Controls

node depencyCollector
node node_modules/ws-unit-testing/queue test-server test-browser-coverage

rm -rf components
mv components-origin components
rm -rf Controls
mv Controls-origin Controls

node coverageUnusedFiles

node node_modules/istanbul/lib/cli report --dir "coverage-report" --include "**/coverage.json" html
node node_modules/istanbul/lib/cli report --dir "cobertura" --include "**/coverage.json" cobertura
node node_modules/istanbul/lib/cli report --dir "coverage-controls-report" --include "**/coverageControls.json" html
node node_modules/istanbul/lib/cli report --dir "coverage-components-report" --include "**/coverageComponents.json" html
