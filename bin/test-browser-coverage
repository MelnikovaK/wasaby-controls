#!/bin/sh
# Run unit testing via browser

node -v
npm install
node node_modules/nyc/bin/nyc instrument ./components ./components-covered
node node_modules/nyc/bin/nyc instrument ./Controls ./Controls-covered

mv components components-origin
mv components-covered components
cp -nR components-origin/* components
mv Controls Controls-origin
mv Controls-covered Controls
cp -nR Controls-origin/* Controls

node depencyCollector
node node_modules/ws-unit-testing/queue test-server test-browser-coverage

rm -rf components
mv components-origin components
rm -rf Controls
mv Controls-origin Controls

#node coverageUnusedFiles

#mkdir artifacts/components
#mv artifacts/coverageComponents.json artifacts/components/coverage.json
#mkdir artifacts/controls
#mv artifacts/coverageControls.json artifacts/controls/coverage.json

#node node_modules/nyc/bin/nyc report --reporter=cobertura --report-dir=cobertura --temp-directory=artifacts
#node node_modules/nyc/bin/nyc report --reporter=html --report-dir=coverage-report --temp-directory=artifacts
#node node_modules/nyc/bin/nyc report --reporter=html --report-dir=coverage-controls-report --temp-directory=artifacts/controls
#node node_modules/nyc/bin/nyc report --reporter=html --report-dir=coverage-components-report --temp-directory=artifacts/components