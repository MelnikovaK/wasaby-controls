#!/bin/sh
# Run unit testing via browser

node -v
npm install

mkdir -p tmp/{Controls,components}
cp -rf Controls/* tmp/Controls/
cp -rf components/* tmp/components/

node node_modules/nyc/bin/nyc instrument tmp tmp-covered

mv Controls Controls-origin
mv components components-origin
mv tmp-covered/Controls Controls
mv tmp-covered/components components
cp -nR Controls-origin/* Controls
cp -nR components-origin/* components
rm -rf tmp/
rm -rf tmp-covered/

node depencyCollector
node node_modules/ws-unit-testing/queue test-server test-browser-coverage

mv Controls-origin Controls
mv components-origin components
rm -rf Controls
rm -rf components

#node coverageUnusedFiles

#mkdir artifacts/components
#mv artifacts/coverageComponents.json artifacts/components/coverage.json
#mkdir artifacts/controls
#mv artifacts/coverageControls.json artifacts/controls/coverage.json
#mkdir artifacts/all
#mv artifacts/coverageAll.json artifacts/all/coverage.json

#node node_modules/nyc/bin/nyc report --reporter=cobertura --report-dir=cobertura --temp-directory=artifacts/all
#node node_modules/nyc/bin/nyc report --reporter=html --report-dir=coverage-report --temp-directory=artifacts/all
#node node_modules/nyc/bin/nyc report --reporter=html --report-dir=coverage-controls-report --temp-directory=artifacts/controls
#node node_modules/nyc/bin/nyc report --reporter=html --report-dir=coverage-components-report --temp-directory=artifacts/components